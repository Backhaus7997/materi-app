generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id           String     @id @default(cuid())
  name         String
  email        String     @unique
  passwordHash String
  user_role    String
  supplierId   String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  carts        Cart[]
  cartItems    CartItem[]
  quotes       Quote[]
  supplier     Supplier?  @relation(fields: [supplierId], references: [id])
}

model Supplier {
  id             String          @id @default(cuid())
  name           String
  company_name   String?
  contact_person String?
  email          String?
  phone          String?
  address        String?
  notes          String?
  payment_terms  String?
  active         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  cartItems      CartItem[]
  products       Product[]
  quoteLineItems QuoteLineItem[]
  users          User[]
}

model Product {
  id              String          @id @default(cuid())
  supplierId      String
  supplier_name   String?
  name            String
  internal_code   String?
  description     String?
  image_url       String?
  category        String?
  unit_of_measure String          @default("unit")
  base_price      Float
  currency        String          @default("USD")
  active          Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  cartItems       CartItem[]
  supplier        Supplier        @relation(fields: [supplierId], references: [id])
  quoteLineItems  QuoteLineItem[]
}

model Quote {
  id                    String          @id @default(cuid())
  vendorId              String
  quote_number          String?         @unique
  customer_name         String
  customer_company      String?
  customer_email        String?
  customer_phone        String?
  status                String          @default("Draft")
  global_margin_percent Float           @default(20)
  total_cost            Float           @default(0)
  total_sale_price      Float           @default(0)
  total_profit_amount   Float           @default(0)
  notes                 String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  vendor                User            @relation(fields: [vendorId], references: [id])
  lineItems             QuoteLineItem[]
}

model QuoteNumberSeq {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
}

model QuoteLineItem {
  id                           String    @id @default(cuid())
  quoteId                      String
  supplierId                   String?
  supplier_name                String?
  productId                    String
  product_name                 String?
  product_description_snapshot String?
  unit_of_measure              String?
  quantity                     Float     @default(1)
  unit_cost_price              Float
  line_cost_total              Float?    @default(0)
  margin_percent               Float?
  unit_sale_price              Float?
  line_sale_total              Float?    @default(0)
  line_profit_amount           Float?    @default(0)
  createdAt                    DateTime  @default(now())
  updatedAt                    DateTime  @updatedAt
  product                      Product   @relation(fields: [productId], references: [id])
  quote                        Quote     @relation(fields: [quoteId], references: [id])
  supplier                     Supplier? @relation(fields: [supplierId], references: [id])
}

model Cart {
  id                    String     @id @default(cuid())
  vendorId              String
  global_margin_percent Float      @default(20)
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  vendor                User       @relation(fields: [vendorId], references: [id])
  items                 CartItem[]
}

model CartItem {
  id                  String    @id @default(cuid())
  cartId              String
  vendorId            String?
  supplierId          String?
  supplier_name       String?
  productId           String
  product_name        String?
  product_description String?
  product_image_url   String?
  unit_of_measure     String?
  quantity            Float     @default(1)
  unit_cost_price     Float
  margin_percent      Float?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  cart                Cart      @relation(fields: [cartId], references: [id])
  product             Product   @relation(fields: [productId], references: [id])
  supplier            Supplier? @relation(fields: [supplierId], references: [id])
  vendor              User?     @relation(fields: [vendorId], references: [id])
}
