generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Cart {
  id                    String     @id
  vendorId              String
  global_margin_percent Float      @default(20)
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  User                  User       @relation(fields: [vendorId], references: [id])
  CartItem              CartItem[]

  @@index([vendorId])
}

model CartItem {
  id                  String    @id
  cartId              String
  vendorId            String?
  supplierId          String?
  supplier_name       String?
  productId           String
  product_name        String?
  product_description String?
  product_image_url   String?
  unit_of_measure     String?
  quantity            Float     @default(1)
  unit_cost_price     Float
  margin_percent      Float?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  Cart                Cart      @relation(fields: [cartId], references: [id])
  Product             Product   @relation(fields: [productId], references: [id])
  Supplier            Supplier? @relation(fields: [supplierId], references: [id])
  User                User?     @relation(fields: [vendorId], references: [id])

  @@index([vendorId])
  @@index([cartId])
  @@index([productId])
  @@index([supplierId])
}

model Product {
  id              String          @id
  supplierId      String
  supplier_name   String?
  name            String
  internal_code   String?
  description     String?
  image_url       String?
  category        String?
  unit_of_measure String          @default("unit")
  base_price      Float
  currency        String          @default("USD")
  active          Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  CartItem        CartItem[]
  Supplier        Supplier        @relation(fields: [supplierId], references: [id])
  QuoteLineItem   QuoteLineItem[]

  @@index([supplierId])
  @@index([active])
  @@index([category])
}

model Quote {
  id                    String          @id
  vendorId              String
  quote_number          String?         @unique
  customer_name         String
  customer_company      String?
  customer_email        String?
  customer_phone        String?
  status                String          @default("Draft")
  global_margin_percent Float           @default(20)
  total_cost            Float           @default(0)
  total_sale_price      Float           @default(0)
  total_profit_amount   Float           @default(0)
  notes                 String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  User                  User            @relation(fields: [vendorId], references: [id])
  QuoteLineItem         QuoteLineItem[]

  @@index([vendorId])
  @@index([status])
  @@index([createdAt])
}

model QuoteLineItem {
  id                           String    @id
  quoteId                      String
  supplierId                   String?
  supplier_name                String?
  productId                    String
  product_name                 String?
  product_description_snapshot String?
  unit_of_measure              String?
  quantity                     Float     @default(1)
  unit_cost_price              Float
  line_cost_total              Float?    @default(0)
  margin_percent               Float?
  unit_sale_price              Float?
  line_sale_total              Float?    @default(0)
  line_profit_amount           Float?    @default(0)
  createdAt                    DateTime  @default(now())
  updatedAt                    DateTime  @updatedAt
  Product                      Product   @relation(fields: [productId], references: [id])
  Quote                        Quote     @relation(fields: [quoteId], references: [id])
  Supplier                     Supplier? @relation(fields: [supplierId], references: [id])

  @@index([quoteId])
  @@index([productId])
  @@index([supplierId])
}

model QuoteNumberSeq {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
}

model Supplier {
  id             String          @id
  name           String
  company_name   String?
  contact_person String?
  email          String?
  phone          String?
  address        String?
  notes          String?
  payment_terms  String?
  active         Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  CartItem       CartItem[]
  Product        Product[]
  QuoteLineItem  QuoteLineItem[]
  User           User[]

  @@index([active])
}

model User {
  id                     String     @id
  name                   String
  email                  String     @unique
  passwordHash           String
  user_role              String
  supplierId             String?
  resetPasswordToken     String?
  resetPasswordExpiresAt DateTime?
  createdAt              DateTime   @default(now())
  updatedAt              DateTime   @updatedAt
  Cart                   Cart[]
  CartItem               CartItem[]
  Quote                  Quote[]
  Supplier               Supplier?  @relation(fields: [supplierId], references: [id])

  @@index([user_role])
  @@index([supplierId])
  @@index([resetPasswordToken])
}
